<html>

<head>
  <!-- Generated by @jspm/generator VSCode Extension - https://github.com/jspm/jspm-vscode -->
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js" crossorigin="anonymous"></script>
  <script type="importmap">
  {
    "imports": {
      "@github/combobox-nav": "https://ga.jspm.io/npm:@github/combobox-nav@3.0.1/dist/index.js",
      "@launchscout/live-template": "https://ga.jspm.io/npm:@launchscout/live-template@0.5.0/index.js"
    },
    "scopes": {
      "https://ga.jspm.io/": {
        "json-joy/esm/json-patch": "https://ga.jspm.io/npm:json-joy@1.19.0/esm/json-patch/index.js",
        "phoenix": "https://ga.jspm.io/npm:phoenix@1.6.15/priv/static/phoenix.mjs",
        "phx-live-state": "https://ga.jspm.io/npm:phx-live-state@0.11.2/build/src/index.js",
        "process": "https://ga.jspm.io/npm:@jspm/core@2.0.1/nodelibs/browser/process.js",
        "reflect-metadata": "https://ga.jspm.io/npm:reflect-metadata@0.1.14/Reflect.js",
        "sprae": "https://ga.jspm.io/npm:sprae@9.1.1/sprae.js",
        "subscript": "https://ga.jspm.io/npm:subscript@7.6.2/subscript.js",
        "swapdom/deflate": "https://ga.jspm.io/npm:swapdom@1.2.1/deflate.js",
        "wc-context": "https://ga.jspm.io/npm:wc-context@1.0.0/core.js"
      }
    }
  }
  </script>
  <script type="module">
    import '@launchscout/live-template';
    import './src/autocomplete-input.js';
  </script>
</head>

<body>
  <live-template url="ws://localhost:4000/live_state" topic="people:all" custom-events="autocomplete-commit,autocomplete-search">
    <table>
      <thead>
        <tr>
          <th><a :sendclick="sort" data-sort-key="last_name">Last name</a></th>
          <th>First name</th>
        </tr>
      </thead>
      <tbody>
        <tr :each="person in people">
          <td><a :sendclick="edit-person" :data-id="person.id" :text="person.last_name"></a></td>
          <td :text="person.first_name"></td>
          <td :text="person.birth_date"></td>
        </tr>
      </tbody>
    </table>
    <button :sendclick="add-person">Add Person</button>
    <dialog :open="editing">
      <form :sendsubmit="save-person">
        <div>
          <label>First name</label>
          <input name="first_name" :value="person.first_name" />
          <span :text="errors.first_name"></span>
        </div>
        <div>
          <label>Last name</label>
          <input name="last_name" :value="person.last_name" />
          <span :text="errors.last_name"></span>
        </div>
        <div>
          <label>Organizations</label>
          <autocomplete-input :sendautocomplete-search="search_organizations" name="organization_id" :value="person.organization && person.organization.id" :display-value="person.organization && person.organization.name">
            <ul slot="list">
              <li :each="organization in organizations" :data-label="organization.name" :data-value="organization.id" role="option" :text="organization.name"></li> 
            </ul>
          </autocomplete-input>
          <span :text="errors.organizations_id"></span>
        </div>
        <div>
          <label>Birth date</label>
          <input name="birth_date" type="date" :value="person.birth_date" />
          <span :text="errors.birth_date"></span>
        </div>
        <button>Save</button>
      </form>
    </dialog>
  </live-template>
</body>

</html>